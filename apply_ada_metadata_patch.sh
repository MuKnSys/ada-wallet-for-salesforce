#!/bin/bash

# This script will patch the UTXOController.cls file to fix ADA/lovelace metadata handling

# Define the patch content
PATCH_CONTENT='            // Initialize metadata maps\n            Map<String, Id> unitToAssetId = new Map<String, Id>();\n            Map<String, String> unitToMetadata = new Map<String, String>();\n            \n            // Add hardcoded metadata for ADA/lovelace if present\n            if (units.contains(\'lovelace\') || units.contains(\'ADA\')) {\n                String adaMetadata = \'{"name":"Cardano","ticker":"ADA","decimals":6}\';\n                unitToMetadata.put(\'lovelace\', adaMetadata);\n                unitToMetadata.put(\'ADA\', adaMetadata);\n                Logger.logDebug(\'Using hardcoded metadata for ADA/lovelace units\');\n                \n                // Remove from units set to skip API calls\n                units.remove(\'lovelace\');\n                units.remove(\'ADA\');\n            }\n            \n            // Fetch metadata for non-ADA tokens only\n            for (String unitKey : units) {\n                try {\n                    String metaJson = BlockfrostService.getAssetMetadata(unitKey);\n                    Logger.logDebug(\'Fetched metadata for token unit: \' + unitKey);\n                    unitToMetadata.put(unitKey, metaJson);\n                } catch (Exception e) {\n                    Logger.logError(\'Error fetching metadata for unit \' + unitKey + \': \' + e.getMessage());\n                    // Continue with other units even if one fails\n                }'
